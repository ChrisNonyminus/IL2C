# IL2C - A translator for ECMA-335 CIL/MSIL to C language.

|Provider|Branch|Build|
|:--|:--|:--|
|AppVeyor|master|[![AppVeyor (.NET 4.5 / .NET Core 2.0)](https://ci.appveyor.com/api/projects/status/bwqk4p8x05vckl0x/branch/master?svg=true)](https://ci.appveyor.com/project/kekyo/il2c/branch/master) [![AppVeyor tests](https://img.shields.io/appveyor/tests/kekyo/il2c/master.svg)](https://ci.appveyor.com/project/kekyo/il2c/branch/master/tests)<br>![Build Stats](https://buildstats.info/appveyor/chart/kekyo/il2c?branch=master&includeBuildsFromPullRequest=false)|
|AppVeyor|devel|[![AppVeyor (.NET 4.5 / .NET Core 2.0)](https://ci.appveyor.com/api/projects/status/bwqk4p8x05vckl0x/branch/devel?svg=true)](https://ci.appveyor.com/project/kekyo/il2c/branch/devel) [![AppVeyor tests](https://img.shields.io/appveyor/tests/kekyo/il2c/devel.svg)](https://ci.appveyor.com/project/kekyo/il2c/branch/devel/tests)<br>![Build Stats](https://buildstats.info/appveyor/chart/kekyo/il2c?branch=devel&includeBuildsFromPullRequest=false)|

## What's this?

* IL2C is a translator (transpiler) for ECMA-335 CIL/MSIL to C language.

* IL2C's implementation priorities, we're aiming for:
  * Better predictability for runtime costs, better human readability for the IL2C translated C source code.
  * Very tiny footprint requirements, we are thinking about how fit between tiny embedded system and large system with many resources.
  * Better code/runtime portability, minimum requirements are only C99 compiler.
  * Better interoperabilities for exist C libraries, we can use standard .NET interop technics (likely P/Invoke.)
  * Contains seamless building system for major C toolkits, for example: CMake system, Arduino IDE, VC++ ...

## Simple hello-world like code

Original C# source code:

```csharp
public static class HelloWorld
{
    public static void Main()
    {
        Console.WriteLine("Hello world with IL2C!");
    }
}
```

Translated to C source code (all comments are stripped):

```c
IL2C_CONST_STRING(string0__, L"Hello world with IL2C!");

void HelloWorld_Main()
{
    struct
    {
        uint8_t objRefCount__;
        uint8_t objRefRefCount__;
        IL2C_EXECUTION_FRAME* pNext__;
        System_String* stack0_0__;
    } frame__ = { 1, 0 };
    il2c_link_execution_frame(&frame__);

    frame__.stack0_0__ = string0__;
    System_Console_WriteLine_10(frame__.stack0_0__);
    il2c_unlink_execution_frame(&frame__);
    return;
}
```

[View with comments and other sample translation results (contains complex results), see this page.](sample-translation-results.md)

## How to beginning

The IL2C current status is experimental. Contributions are welcome but there's nothing the official guide documents.
This is first step for use the IL2C:

1. Open the il2c.sln by Visual Studio 2017. Your environment requires enabling the C#, VC++ and NUnit3 vsix addin.
2. Build with "Debug - AnyCPU" configuration.
3. If didn't show any errors, kick starts unit test at the Test Explorer (Run All).
4. Unit tests need long time for first time execution. These tests are running with the gcc by automated downloads mingw platform.
5. All test passed, you are ready to hacks! I asked for you have to see in ["tests/IL2C.Core.Test.Target project"](https://github.com/kekyo/IL2C/tree/master/tests/IL2C.Core.Test.Target). It has a lot of unit test code. And if unit tests are success, you can find translated results in ["tests/IL2C.Core.Test.Fixture project"](https://github.com/kekyo/IL2C/tree/master/tests/IL2C.Core.Test.Fixture) subfolder "bin/Debug/net462."

If you know the CI engineering, you can get more information from the ["appveyor.yml"](appveyor.yml) file.

## Overall status

### These list are auto-generated by unit test.

* [Supported IL opcodes list](supported-opcodes.md)

* [Supported basic types](supported-basic-types.md)

* [Supported runtime system features](supported-runtime-system-features.md)

### These list are manually maintanance (and maybe older...)

#### Support basic types

| Issue | Status | Milestone
|:---|:---|:---|
| Value types | Partial supported | M3
| Class types | Partial supported |
| Managed reference | Partial supported | M3
| Unmanaged pointer |
| Enum types | Partial supported |
| Delegate types | Partial supported |
| Interface types | Partial supported |
| Nested types |
| Class inherits | Partial supported |
| Interface implements | Partial supported |
| Array types | Partial supported |
| Multi dimensional array types |
| Closed generic types |
| Open generic types | (not support) | -

#### Support type members

| Issue | Status | Milestone
|:---|:---|:---|
| Static field | Partial supported | M3
| Instance field | Partial supported | M3
| Static method | Partial supported | M3
| Instance method | Partial supported | M3
| Virtual method (class) | Supported |
| Virtual method (interface) | Partial supported |
| Interop method (extern static) | Partial supported |
| Internal method (internal call) |
| Constructor | Partial supported |
| Constructor (ValueType) | Partial supported | M3
| Type initializer |
| Static property |
| Instance property |
| Static event |
| Instance event |

#### Support metadata handling

| Issue | Status | Milestone
|:---|:---|:---|
| Value type scopes | Partial supported | M3
| Class type scopes | Partial supported |
| Enum type scopes |
| Delegate type scopes |
| Interface type scopes | Partial supported |
| Nested type scopes |
| Field scopes | Partial supported | M3
| Method scopes | Partial supported | M3
| Property scopes |
| Event scopes |
| Can handle reflection | (not support) | -

#### Support runtime relates

| Issue | Status | Milestone
|:---|:---|:---|
| Referenced instance handler | Partial supported | 
| Value type boxed instance handler | Partial supported |
| Collect unused instance (GC) | Partial supported |
| Heap compaction (GC) |
| Exception throw and handles | Partial supported |
| Async exception throws | Partial supported |
| Monitor lock features |
| Platform invoke (P/Invoke) | Partial supported |
| Can handle unsafe pointers |
| Can handle marshaling features (Marshal) |

#### Application lifecycle managements

| Issue | Status | Milestone
|:---|:---|:---|
| Basic commandline driver | Partial supported | M2
| MSBuild (old/Task handler) |
| MSBuild (new/.NET Core CLI) |
| Platform independent core library |
| Translator platform on .NET 4.5 | Supported | M1
| Translator platform on .NET Core 1 | (not support) | -
| Translator platform on .NET Core 2 | Supported |
| Translator platform on mono |
| Support C99 compilers | Supported | M1
| Support non C99 (ANSI) compilers | Supported |
| Support better C code output via C++ symbol declarations |
| Support continuous integrations | Partial supported |

## License

Under Apache v2.

## Related informations

* Public YouTube recorded videos: ["Making archive IL2C play list"](http://bit.ly/2xtu4MH)
  * "How to create IL2C or same tool of IL2CPP? This video contains pure design process through concept and details."

* Polish notation calculator project for IL2C proof of concept
  * [Minimum, but useful impls for "Win32", "UEFI" and "M5Stack(ESP32)"](samples/Calculator)
  * ![Calculator.M5Stack](images/Calculator.M5Stack.jpg)

* Center CLR video letter: "Tested IL2C on micro:bit and arduino platform #8"
  * [![Tested IL2C on micro:bit and arduino platform #8](images/microbit.jpg)](http://bit.ly/2xGFo9J)

* Public conference session video: "Making archive IL2C #6-28 at .NET Conf 2017 Tokyo"
  * [.NET Conf 2017 in Tokyo Room B (In japanese)](https://csugjp.connpass.com/event/66004/)
  * [YouTube video](http://bit.ly/2hI1jTb)

* Milestone 2+ informations included the book of "Extensive Xamarin - Techbook Fest part 3"
  * [Extensive Xamarin - Xamaritans (In japanese)](http://bit.ly/2ycNVzW)

* Public conference session: "Making archive IL2C #6-51 at .NET 600"
  * [.NET 600 conference (In japanese)](https://centerclr.connpass.com/event/71414/)
  * [YouTube video](http://bit.ly/2DiaoKZ)
  * [Slide](https://www.slideshare.net/kekyo/write-common-run-anywhere)

* Public conference session: "How to make the calculator at .NET Fringe Japan 2018 / Making archive IL2C #6-52"
  * [.NET Fringe Japan 2018 New Year Party (In Japanese)](https://dotnetfringe-japan.connpass.com/event/74536/)
  * [Slide](https://www.slideshare.net/kekyo/how-to-make-the-calculator)

* Public conference session: "Making archive IL2C #6-53 at MVP Summit F# Meetup / SEATTLE F# USERS GROUP"
  * [MVP Summit F# Meetup / F# Seattle User Group](https://www.meetup.com/en-US/FSharpSeattle/events/247905452/)
  * [Slide](https://www.slideshare.net/kekyo/mvp-summit-f-meetup-making-archive-il2c-653)

* Public conference session: "Making archive IL2C #6-54 at MVP SUMMIT â€“ VS HACKATHON"
  * [Microsoft MVP Global Summit 2018](https://mvp.microsoft.com/en-us/Summit/Agenda)
  * [Slide](https://www.slideshare.net/kekyo/making-archive-il2c-654-at-mvp-summit-2018-vs-hackathon)

## Took pictures on design process

* #6-6: Near milestones

  ![#6-6: Near milestones](images/IMG_20170917_194810.jpg)

* #6-14: Data flow analysis

  ![#6-14: Data flow analysis](images/IMG_20170926_225355.jpg)

* Milestone 1: Tested on VC++ and we checked how C compiler's optimizer work.

  ![Milestone 1: Tested on VC++ and we checked how C compiler's optimizer work](images/il2c1.png)

* #6-48: How works mark-and-sweep garbage collection on translated code.

  ![#6-48: How works mark-and-sweep garbage collection on translated code](images/IMG_20171130_200549.jpg)

* How to do overload/override/virtual method symbol calculus.

  ![How to do overload/override/virtual method symbol calculus](images/IMG_20181028_165314.jpg)
  
* How to translate exception handlers when combined the local unwind and global unwind.
  * We are thinking about at [Center CLR Try! development meetup (11/10/2018, Japanese)](https://centerclr.connpass.com/event/107981/)

  ![How to translate exception handlers when combined the local unwind and global unwind](images/IMG_20181110_181756.jpg)
    
* This is the strcuture graph for the exection-frame and exception-frame.

  ![This is the strcuture graph for the exection-frame and exception-frame](images/IMG_20181112_120412.jpg)
