<!--
////////////////////////////////////////////////////////////////////////////
//
// IL2C - A translator for ECMA-335 CIL/MSIL to C language.
// Copyright (c) Kouji Matsui (@kozy_kekyo, @kekyo@mastodon.cloud)
//
// Licensed under Apache-v2: https://opensource.org/licenses/Apache-2.0
//
////////////////////////////////////////////////////////////////////////////
-->
<Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
    
  <PropertyGroup Condition="'$(OS)' == 'Windows_NT'">
    <IL2CNativeCompilerConditionalFlags Condition="'$(IL2CConfiguration)' == 'Debug'">$(_IL2C_GCC_DebugFlags)</IL2CNativeCompilerConditionalFlags>
    <IL2CNativeCompilerConditionalFlags Condition="'$(IL2CConfiguration)' == 'Release'">$(_IL2C_GCC_ReleaseFlags)</IL2CNativeCompilerConditionalFlags>
    <IL2CNativeMainTemplatePath Condition="'$(OutputType)' == 'WinExe'">$(_IL2C_WinExeMainTemplatePath)</IL2CNativeMainTemplatePath>
  </PropertyGroup>

  <!-- Extract toolchain 7zip archive only once. -->
  <Target Name="_IL2C_Extract_GCC4_MinGW32_PackedToolchainArchive" BeforeTargets="IL2CBuildRuntimeLibrary"
    Condition="('$(OS)' == 'Windows_NT') AND (!Exists($(_IL2C_GCC4_MinGW32_NativeToolchainPath)))">
      
    <PropertyGroup>
      <_IL2C_TemporaryDirPathForExtractionGCC4PackedToolchainArchive>$([System.IO.Path]::Combine('$(_IL2C_GCC4_MinGW32_NativeToolchainBasePath)','$([System.Guid]::NewGuid().ToString())'))</_IL2C_TemporaryDirPathForExtractionGCC4PackedToolchainArchive>
    </PropertyGroup>
      
    <MakeDir Directories="$(_IL2C_TemporaryDirPathForExtractionGCC4PackedToolchainArchive)" />
    <Exec WorkingDirectory="$(_IL2C_TemporaryDirPathForExtractionGCC4PackedToolchainArchive)"
      Command="&quot;$(_IL2C_GCC4_MinGW32_PackedNativeToolchainArchivePath)&quot;" />
    <_IL2C_Build_MoveDirectory
      From="$([System.IO.Path]::Combine('$(_IL2C_TemporaryDirPathForExtractionGCC4PackedToolchainArchive)','$(_IL2C_GCC4_MinGW32_NativeToolchainName)'))"
      To="$(_IL2C_GCC4_MinGW32_NativeToolchainPath)" />
    <RemoveDir Directories="$(_IL2C_TemporaryDirPathForExtractionGCC4PackedToolchainArchive)" />
  
  </Target>
    
</Project>
